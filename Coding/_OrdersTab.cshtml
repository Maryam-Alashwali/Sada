@model Sada.ViewModels.Tailor.TailorOrderListViewModel

<div class="tab-pane fade show active" id="orders" role="tabpanel">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4>Order Management</h4>
        <div class="btn-group">
            <a asp-area="Tailor" asp-controller="Order" asp-action="Index" asp-route-status="all"
               class="btn btn-outline-primary @(Model.CurrentStatus == "all" ? "active" : "")">
                All Orders (@Model.Stats.All)
            </a>
            <a asp-area="Tailor" asp-controller="Order" asp-action="Index" asp-route-status="requested"
               class="btn btn-outline-primary @(Model.CurrentStatus == "requested" ? "active" : "")">
                New Requests (@Model.Stats.Requested)
            </a>
            <a asp-area="Tailor" asp-controller="Order" asp-action="Index" asp-route-status="in_progress"
               class="btn btn-outline-primary @(Model.CurrentStatus == "in_progress" ? "active" : "")">
                In Progress (@Model.Stats.InProgress)
            </a>
        </div>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <!-- Order Cards -->
    @if (Model.Orders?.Any() == true)
    {
        @foreach (var order in Model.Orders)
        {
            <div class="order-card mb-4">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <h5 class="mb-1">Order #ORD-@order.OrderId.ToString().PadLeft(4, '0')</h5>
                        <span class="status-badge status-@order.OrderStatus.Replace("_", "-")">
                            @order.OrderStatus.Replace("_", " ")
                        </span>
                        <p class="mb-0 text-muted small">
                            <i class="fas fa-user me-1"></i>
                            Client: @order.ClientName
                        </p>
                        <p class="mb-0 text-muted small">
                            <i class="fas fa-phone me-1"></i>
                            @order.ClientEmail
                        </p>
                        @if (order.Services?.Any() == true)
                        {
                            <p class="mb-0 text-muted small">
                                <i class="fas fa-concierge-bell me-1"></i>
                                Services: @string.Join(", ", order.Services.Select(s => s.ServiceName))
                            </p>
                        }
                    </div>
                    <div class="text-end">
                        <p class="fw-bold mb-0" style="color: var(--pecan);">
                            @order.TotalPrice?.ToString("F2") SR
                        </p>
                        <p class="small mb-0 text-muted">
                            <i class="fas fa-calendar me-1"></i>
                            @order.DateCreated?.ToString("MMM dd, yyyy")
                        </p>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="d-flex gap-2 mt-3 flex-wrap">
                    @if (order.OrderStatus == "requested")
                    {
                        <form asp-area="Tailor" asp-controller="Order" asp-action="Accept"
                              asp-route-id="@order.OrderId" method="post" class="d-inline">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-success btn-sm"
                                    onclick="return confirm('Are you sure you want to accept this order?')">
                                <i class="fas fa-check me-1"></i> Accept Order
                            </button>
                        </form>

                        <form asp-area="Tailor" asp-controller="Order" asp-action="Decline"
                              asp-route-id="@order.OrderId" method="post" class="d-inline">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-danger btn-sm"
                                    onclick="return confirm('Are you sure you want to decline this order?')">
                                <i class="fas fa-times me-1"></i> Decline
                            </button>
                        </form>
                    }
                    else if (new[] { "accepted", "in_progress", "ready_for_pickup" }.Contains(order.OrderStatus))
                    {
                        <button class="btn btn-primary btn-sm" data-bs-toggle="modal"
                                data-bs-target="#updateStatusModal@(order.OrderId)">
                            <i class="fas fa-edit me-1"></i> Update Status
                        </button>
                    }

                    <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal"
                            data-bs-target="#messageModal@(order.OrderId)">
                        <i class="fas fa-comment me-1"></i> Message Client
                    </button>

                    <a asp-area="Tailor" asp-controller="Order" asp-action="Show" asp-route-id="@order.OrderId"
                       class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-eye me-1"></i> View Details
                    </a>
                </div>
            </div>

            <!-- Update Status Modal -->
            <div class="modal fade" id="updateStatusModal@(order.OrderId)" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Update Order Status</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <form asp-area="Tailor" asp-controller="Order" asp-action="UpdateStatus" method="post">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="OrderId" value="@order.OrderId" />
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label class="form-label">Select New Status</label>
                                    <select class="form-select" name="Status" required>
                                        <option value="accepted" selected="@(order.OrderStatus == "accepted")">Accepted</option>
                                        <option value="in_progress" selected="@(order.OrderStatus == "in_progress")">In Progress</option>
                                        <option value="ready_for_pickup" selected="@(order.OrderStatus == "ready_for_pickup")">Ready for Pickup</option>
                                        <option value="completed" selected="@(order.OrderStatus == "completed")">Completed</option>
                                        <option value="cancelled" selected="@(order.OrderStatus == "cancelled")">Cancelled</option>
                                    </select>
                                </div>
                                <div class="alert alert-info">
                                    <small>
                                        <i class="fas fa-info-circle me-1"></i>
                                        The client will be notified about this status change.
                                    </small>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-primary">Update Status</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Message Modal -->
            <div class="modal fade" id="messageModal@(order.OrderId)" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Message Client</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <form asp-area="Tailor" asp-controller="Order" asp-action="SendMessage" method="post">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="orderId" value="@order.OrderId" />
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label class="form-label">Message to @order.ClientName</label>
                                    <textarea class="form-control" name="messageText" rows="4"
                                      placeholder="Type your message here..." required maxlength="1000"></textarea>
                                    <div class="form-text">Maximum 1000 characters</div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-primary">Send Message</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        }
    }
    else
    {
        <div class="text-center py-5">
            <i class="fas fa-shopping-bag fa-3x text-muted mb-3"></i>
            <h5>No Orders Found</h5>
            <p class="text-muted">
                @if (Model.CurrentStatus == "requested")
                {
                    <text>You don't have any new order requests at the moment.</text>
                }
                else if (Model.CurrentStatus == "in_progress")
                {
                    <text>You don't have any orders in progress.</text>
                }
                else
                {
                    <text>You don't have any orders at the moment.</text>
                }
            </p>
        </div>
    }
</div>

<style>
    .order-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border-left: 4px solid #007bff;
        transition: all 0.3s ease;
    }

        .order-card:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

    .status-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        display: inline-block;
        margin-bottom: 8px;
    }

    .status-requested {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
    }

    .status-accepted {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #b8daff;
    }

    .status-in-progress {
        background: #cce7ff;
        color: #004085;
        border: 1px solid #b3d7ff;
    }

    .status-ready-for-pickup {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
    }

    .status-completed {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }

    .status-cancelled {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }
</style>